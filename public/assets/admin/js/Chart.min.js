let ctx = document.getElementById('Chart1').getContext('2d');
let chart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: [],
        datasets: [{
            label: 'Doanh thu',
            data: [],
            borderColor: 'rgb(75, 192, 192)',
            tension: 0.1,
            fill: false
        }]
    },
    options: {          
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    stepSize: 1000000,
                    callback: function(value) {
                        return value.toLocaleString() + ' VND';
                    }
                }
            }
        },
        plugins: {
            tooltip: {
                callbacks: {
                    label: function(context) {
                        return (context.raw / 1000000).toFixed(1) + ' triệu VND';
                    }
                }
            }
        }
    }
});
 function updateChart(timeframe) {
    fetch(window.location.pathname + '?timeframe=' + timeframe)
        .then(response => response.text())
        .then(html => {
            let parser = new DOMParser();
            let doc = parser.parseFromString(html, 'text/html');
            let newChartData = JSON.parse(doc.querySelector('#chartData').textContent);
            
            chart.data.labels = newChartData.labels;
            chart.data.datasets[0].data = newChartData.sales;
            chart.update();
        });
}
 document.getElementById('timeframeSelect').addEventListener('change', function() {
    updateChart(this.value);
});
 updateChart('weekly');

 document.addEventListener('DOMContentLoaded', function() {
    const exportButton = document.querySelector('#exampleModal .btn-primary');
   exportButton.addEventListener('click', function() {
       const startDate = document.querySelector('#startDate').value;
       const endDate = document.querySelector('#endDate').value;
       
       if (!startDate || !endDate) {
           alert('Vui lòng chọn đầy đủ ngày bắt đầu và ngày kết thúc');
           return;
       }
       
        const exportUrl = `/admin/dashboard?export=true&startDate=${startDate}&endDate=${endDate}`;
       
        window.location.href = exportUrl;
       
        $('#exampleModal').modal('hide');
   });
});